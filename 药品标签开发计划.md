# 药品标签开发计划

## 1. 项目概述

### 1.1 项目目标

开发一个专业的药品标签管理系统，支持多语言标签编辑、实时预览和 PDF 生成功能，满足国际化药品标签制作需求。

### 1.2 功能范围

- 多语言标签编辑（支持 26 种语言）
- 实时标签预览功能
- 动态页面尺寸控制
- PDF 文件生成和导出
- 智能字体映射系统
- 产品信息分类处理（A/B/C 型）

## 2. 技术方案

### 2.1 技术选型

- 前端技术栈：
  - Next.js 14.2.16 (React 18) 前端框架
  - Tailwind CSS + Radix UI 组件库
  - TypeScript 类型安全
  - React Context API 状态管理
- 后端技术栈：
  - Node.js + Express.js Web 框架
  - RESTful API 接口
  - Sequelize ORM 数据库操作
- PDF 处理：pdf-lib, pdfjs-dist, jspdf, @react-pdf/renderer
- 数据存储：MySQL + Sequelize ORM
- 认证系统：JWT + bcryptjs

### 2.2 系统架构

1. 前端层（Next.js 应用）：
   - 标签编辑器组件（LabelEditor）
   - PDF 预览组件（PDFPreview）
   - 项目管理组件（ProjectList, ProjectInfo）
   - 布局组件（Layout）
   - 上下文状态管理（LabelContext）
2. 后端层（Express.js 服务）：
   - RESTful API 接口服务
   - 用户认证中间件
   - 数据库模型管理
   - PDF 生成服务

### 2.3 核心功能模块

- **多语言支持**：26 种语言（阿联酋阿拉伯语到越南语）
- **智能字体映射**：中文 →STHeiti，泰文/阿拉伯文 →Arial Unicode，其他 →Arial
- **动态页面计算**：根据序号自动调整页面宽度和边距
- **实时预览**：所见即所得的标签预览功能

## 3. 开发阶段

### 3.1 第一阶段：基础功能开发 ✅ 已完成

- ✅ 搭建 Next.js + Express.js 项目框架
- ✅ 实现标签编辑器界面
- ✅ 开发基础组件库
- ✅ 建立项目结构和配置

### 3.2 第二阶段：核心功能实现 ✅ 已完成

- ✅ 实现多语言选择功能
- ✅ 开发智能字体映射系统
- ✅ 实现实时预览功能
- ✅ 开发动态页面尺寸计算

### 3.3 第三阶段：PDF 功能开发 🔄 进行中

- ✅ 集成 PDF 处理库
- 🔄 完善 PDF 生成功能
- 🔄 实现复杂页面尺寸规则
- ⏳ 开发 PDF 导出功能

### 3.4 第四阶段：数据库集成与数据持久化 ⏳ 待开始

- ⏳ MySQL 数据库连接配置
- ⏳ Sequelize 数据模型实现
- ⏳ 项目数据持久化存储
- ⏳ 数据查询和操作接口

### 3.5 第五阶段：批量处理与性能优化 ⏳ 待开始

- ⏳ 批量项目创建功能
- ⏳ 批量 PDF 导出功能
- ⏳ 系统性能优化
- ⏳ 代码分割和懒加载

### 3.6 第六阶段：测试与质量保障 ⏳ 待开始

- ⏳ 单元测试框架搭建
- ⏳ 集成测试实现
- ⏳ 端到端测试
- ⏳ 自动化测试流程

### 3.7 第七阶段：部署与运维 ⏳ 待开始

- ⏳ 生产环境部署配置
- ⏳ CI/CD 流水线搭建
- ⏳ 监控和日志系统
- ⏳ 备份和恢复策略

### 3.8 第八阶段：用户认证系统 ⏳ 最后执行

- ⏳ JWT 认证系统实现
- ⏳ 用户注册和登录功能
- ⏳ 权限管理系统
- ⏳ API 安全加固

## 4. 当前功能特色

### 4.1 已实现功能

- **多语言标签编辑**：支持 26 种国际语言
- **智能字体系统**：根据语言自动选择最适合的字体
- **实时预览**：编辑内容实时显示在预览区域
- **动态尺寸计算**：根据页面序号自动调整宽度和边距
- **响应式界面**：现代化的用户界面设计

### 4.2 待开发功能（按优先级排序）

**高优先级：**

- 数据库集成和数据持久化存储
- PDF 文件信息提取功能
- 完整的 PDF 导出功能
- 批量处理功能

**中优先级：**

- 系统性能优化
- 测试系统搭建
- 移动端适配

**低优先级：**

- 项目文档完善
- 部署和运维配置
- 用户认证和权限管理（最后执行）

## 5. 技术规范

### 5.1 信息分类标准

- A 型信息：

  1. 自动在前面添加罗马数字编号（I、II、III、IV、V、VI、VII、VIII、IX）
  2. 每行默认排列 2 个项目，可手动调整数量
  3. 根据项目总数自动计算所需行数
  4. 行内项目间距自动平均分配

- B 型信息：

  1. 每行默认排列 2 个项目，可手动调整数量
  2. 根据项目总数自动计算所需行数
  3. 行内项目间距自动平均分配
  4. 项目之间使用下划线(\_)或使用 0.15mm 的线填充空白区域

- C 型信息：
  1. 使用区域文本框包含所有项目，支持自动换行
  2. 项目之间使用两个空格进行分隔
  3. 第 1 个项目单独一行（一般为药品品名+规格）
  4. 倒数第 2 个项目+倒数第 1 个项目合并后单独一行（一般为临床试验申请人+公司名称）
  5. 其他项目在两者之间，自动换行

### 5.2 PDF 生成规范

- 页面尺寸规则

  1. 标准页面尺寸定义
     - W: 页面宽度
     - H: 页面高度
  2. 页面宽度变化规则（高度保持不变）：

  - 第 1/2 页：宽度为 W
  - 第 3/4 页：宽度为 W+0.5
  - 第 5/6 页：宽度为 W-2
  - 第 7/8 页：宽度为 W-1.5
  - 第 9/10 页：宽度为 W-4
  - 第 11/12 页：宽度为 W-3.5
  - 第 13/14 页：宽度为 W-6
  - 第 15/16 页：宽度为 W-5.5
    以此类推

  3. 裁切框（CropBox）规则：

  - 裁切框的尺寸为页面尺寸减去上下左右的边距
  - 裁切框的左上角坐标为(2,2)
  - 所有页面的上、下、左边距均为 2
  - 页面右边距在第 4、8、12、16 页（每 4 页递增）为 5，其余页面为 2

## 6. 项目风险

### 6.1 技术风险

- PDF 文件格式兼容性
- 文本提取准确性
- 多语言字符集支持

### 6.2 解决方案

- 建立完善的测试用例
- 制定严格的数据验证机制
- 采用国际化标准的字符集编码

## 7. 开发进度

### 7.1 已完成阶段（前 4 周）

- ✅ 第 1-2 周：基础功能开发（Next.js + Express.js 框架搭建）
- ✅ 第 3-4 周：核心功能实现（多语言编辑器、智能字体映射）

### 7.2 当前阶段（第 5-6 周）

- 🔄 PDF 生成功能完善
- 🔄 复杂页面尺寸规则实现
- 🔄 导出功能优化

### 7.3 后续规划（第 7-16 周）

- ⏳ 第 7-8 周：数据库集成和数据持久化
- ⏳ 第 9-10 周：批量处理功能和性能优化
- ⏳ 第 11-12 周：测试系统搭建和质量保障
- ⏳ 第 13-14 周：部署和运维系统
- ⏳ 第 15-16 周：用户认证系统（最后执行）

## 8. 验收标准

### 8.1 功能验收

- 信息分类准确率 > 99%
- PDF 生成成功率 = 100%

### 8.2 性能验收

- 单个 PDF 处理时间 < 60 秒
- 系统内存占用 < 32GB
