# 详细调试步骤 - PDF 保存功能

## ✅ 已完成的准备工作

1. ✅ **数据库字段**：`pdf_file_path` 已确认存在
2. ✅ **uploads 目录**：已创建，权限正常
3. ✅ **后端服务器**：已重启，带详细日志
4. ✅ **前端代码**：已添加详细日志
5. ✅ **React Hooks**：所有问题已修复

## 🧪 现在请执行测试

### 步骤 1：刷新前端

```
按 Cmd+Shift+R (Mac) 或 Ctrl+Shift+R (Windows/Linux)
强制刷新浏览器，加载最新代码
```

### 步骤 2：打开开发者工具

```
按 F12 打开开发者工具
切换到 Console 标签
```

### 步骤 3：测试保存标签

1. 选择一个项目（如：项目 29）
2. 选择一个语言（如：KR South Korea/Korean）
3. 选择序号（如：1）
4. 点击 "保存标签" 按钮

### 步骤 4：观察日志输出

#### 前端 Console 应该显示：

```
✅ 标签保存成功，PDF正在生成中...
📥 收到PDF生成请求: {projectId: 29, countryCode: "...", sequenceNumber: "1"}
🔧 开始保存PDF文件: {projectId: 29, countryCode: "...", fileName: "...", blobSize: ...}
🔧 Base64转换完成，长度: ...
🔧 请求URL: http://localhost:3001/api/projects/29/countries/.../save-pdf
✅ PDF生成并保存成功
```

#### 后端终端应该显示：

```
📥 接收PDF保存请求: {
  projectId: '29',
  countryCode: '...',
  fileName: '...',
  pdfBase64Length: ...,
  bodyKeys: [ 'pdfBase64', 'fileName' ]
}
✅ PDF文件保存成功: /path/to/uploads/pdfs/...
```

## 🐛 如果出现错误

### 前端显示 500 错误

**请查看后端终端输出**，会显示：

```
❌ 保存PDF文件失败:
错误类型: ...
错误信息: ...
错误堆栈: ...
```

**请将后端终端的完整错误信息发给我！**

### 常见错误及解决方法

#### 错误 1：国别翻译组不存在

```
错误信息: 国别翻译组不存在
```

**解决方法**：

- 确认选择的项目和语言组合在数据库中存在
- 可以尝试先在"标签编辑器"中编辑内容，保存后再测试

#### 错误 2：PDF 数据不能为空

```
错误信息: PDF数据不能为空
```

**解决方法**：

- 检查前端 Console，确认 `blobSize` 大于 0
- 检查 PDF 预览是否正常显示

#### 错误 3：文件系统错误

```
错误类型: EACCES 或 ENOENT
```

**解决方法**：

```bash
# 创建目录
mkdir -p /Users/Tiandiyiqi/Documents/Prepress/LabelMedix/BackEnd/uploads/pdfs

# 设置权限
chmod 755 /Users/Tiandiyiqi/Documents/Prepress/LabelMedix/BackEnd/uploads/pdfs
```

#### 错误 4：数据库错误

```
错误类型: SequelizeValidationError 或 SequelizeDatabaseError
```

**解决方法**：

- 检查数据库连接
- 运行迁移：`cd BackEnd && npx sequelize-cli db:migrate`

## 📊 验证成功

### 检查文件是否保存

```bash
ls -la /Users/Tiandiyiqi/Documents/Prepress/LabelMedix/BackEnd/uploads/pdfs/
```

应该看到新生成的 PDF 文件。

### 通过浏览器访问

```
http://localhost:3001/uploads/pdfs/项目名-语言-序号.pdf
```

应该能看到或下载 PDF 文件。

### 检查数据库

```bash
cd /Users/Tiandiyiqi/Documents/Prepress/LabelMedix/BackEnd
node -e "
const db = require('./src/models');
db.CountryTranslationGroup.findOne({
  where: {
    project_id: 29,
    country_code: 'KR South Korea/Korean'
  }
}).then(group => {
  if (group) {
    console.log('pdf_file_path:', group.pdf_file_path);
  } else {
    console.log('翻译组不存在');
  }
  process.exit(0);
});
"
```

应该显示 PDF 文件路径。

---

## 🎯 关键信息

**请测试后告诉我：**

1. 前端 Console 的完整输出（特别是 🔧 开头的日志）
2. **后端终端的完整输出**（特别是 ❌ 错误信息）

这些信息对于定位问题至关重要！

---

**玄鉴！！！玄鉴！！！玄鉴编程，使命必达！！！！！！！**
