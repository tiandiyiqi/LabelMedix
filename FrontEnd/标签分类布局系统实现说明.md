# 标签分类布局系统实现说明

## 1. 修改概述

本次修改实现了基于标签分类的多布局系统，将原有的单一阶梯标布局扩展为 5 种不同的布局方式。

---

## 2. 实现的功能

### 2.1 布局函数系统

创建了 5 个独立的布局渲染函数，每个函数负责一种标签分类的 PDF 内容渲染：

1. **`renderStepLayout()`** - 阶梯标布局
2. **`renderLeftRight1Layout()`** - 单页左右 1 布局
3. **`renderLeftRight2Layout()`** - 单页左右 2 布局
4. **`renderTopBottom1Layout()`** - 单页上下 1 布局
5. **`renderTopBottom2Layout()`** - 单页上下 2 布局

### 2.2 路由系统

创建了`renderContentByCategory()`函数，根据`labelCategory`的值自动选择对应的布局函数：

```typescript
const renderContentByCategory = () => {
  switch (labelCategory) {
    case "阶梯标":
      return renderStepLayout();
    case "单页左右1":
      return renderLeftRight1Layout();
    case "单页左右2":
      return renderLeftRight2Layout();
    case "单页上下1":
      return renderTopBottom1Layout();
    case "单页上下2":
      return renderTopBottom2Layout();
    default:
      return renderStepLayout();
  }
};
```

### 2.3 兼容性处理

保持了原有的`renderSixFields()`函数名，确保不破坏现有代码：

```typescript
const renderSixFields = renderContentByCategory;
```

---

## 3. 各布局函数详解

### 3.1 阶梯标布局 - `renderStepLayout()`

**特点**：

- 保留原有的六字段独立处理逻辑
- 使用`SmartMixedFontText`处理中英文混排
- 支持动态样式和字体配置

**实现**：

```typescript
const renderStepLayout = () => {
  return (
    <>
      {processedFields.map((field, fieldIndex) => (
        <View key={`field-${fieldIndex}`} style={dynamicStyles.fieldContainer}>
          {field.lines.map((line, lineIndex) => (
            <View key={`line-${lineIndex}`} style={dynamicStyles.lineContainer}>
              <SmartMixedFontText
                primaryFont={fontFamily}
                secondaryFont={labelData.secondaryFontFamily}
                style={dynamicStyles.fieldLine}
              >
                {line}
              </SmartMixedFontText>
            </View>
          ))}
        </View>
      ))}
    </>
  );
};
```

### 3.2 单页左右 1 布局 - `renderLeftRight1Layout()`

**特点**：

- 显示"单页左右 1"文字（青色 #30B8D6）
- 居中显示
- 字体大小为原字体的 2 倍

**当前状态**：模拟实现，仅显示标签分类名称

**未来扩展**：

- 实现左右分栏布局
- 左侧显示特定字段，右侧显示其他字段
- 支持自定义分栏比例

### 3.3 单页左右 2 布局 - `renderLeftRight2Layout()`

**特点**：

- 显示"单页左右 2"文字（绿色 #10B981）
- 居中显示
- 字体大小为原字体的 2 倍

**当前状态**：模拟实现，仅显示标签分类名称

**未来扩展**：

- 实现左右分栏布局（变体 2）
- 可能采用不同的字段分配策略
- 支持不同的间距和对齐方式

### 3.4 单页上下 1 布局 - `renderTopBottom1Layout()`

**特点**：

- 显示"单页上下 1"文字（橙色 #F59E0B）
- 居中显示
- 字体大小为原字体的 2 倍

**当前状态**：模拟实现，仅显示标签分类名称

**未来扩展**：

- 实现上下分栏布局
- 上部显示特定字段，下部显示其他字段
- 支持自定义分栏比例

### 3.5 单页上下 2 布局 - `renderTopBottom2Layout()`

**特点**：

- 显示"单页上下 2"文字（红色 #EF4444）
- 居中显示
- 字体大小为原字体的 2 倍

**当前状态**：模拟实现，仅显示标签分类名称

**未来扩展**：

- 实现上下分栏布局（变体 2）
- 可能采用不同的字段分配策略
- 支持不同的间距和对齐方式

---

## 4. 代码结构

### 4.1 修改位置

文件：`FrontEnd/app/components/PDFPreview.tsx`
行数：约 668-798 行

### 4.2 代码组织

```
布局渲染函数系统
├── renderStepLayout()          (阶梯标布局 - 完整实现)
├── renderLeftRight1Layout()    (单页左右1 - 模拟实现)
├── renderLeftRight2Layout()    (单页左右2 - 模拟实现)
├── renderTopBottom1Layout()    (单页上下1 - 模拟实现)
├── renderTopBottom2Layout()    (单页上下2 - 模拟实现)
├── renderContentByCategory()   (路由函数)
└── renderSixFields()           (兼容性别名)
```

---

## 5. 使用方式

### 5.1 UI 控制

用户通过 PDF 预览界面的"标签分类"下拉框选择布局类型：

```typescript
<select
  value={labelCategory}
  onChange={(e) => updateLabelData({ labelCategory: e.target.value })}
>
  <option value="阶梯标">阶梯标</option>
  <option value="单页左右1">单页左右1</option>
  <option value="单页左右2">单页左右2</option>
  <option value="单页上下1">单页上下1</option>
  <option value="单页上下2">单页上下2</option>
</select>
```

### 5.2 自动切换

选择不同的标签分类后，PDF 预览会自动更新，使用对应的布局函数渲染内容。

---

## 6. 测试方法

### 6.1 功能测试

1. 打开项目，进入 PDF 预览页面
2. 找到"标签分类"下拉框
3. 依次选择每种布局类型
4. 观察 PDF 预览的变化

### 6.2 预期结果

- **阶梯标**：显示正常的六字段内容布局
- **单页左右 1**：显示青色的"单页左右 1"文字
- **单页左右 2**：显示绿色的"单页左右 2"文字
- **单页上下 1**：显示橙色的"单页上下 1"文字
- **单页上下 2**：显示红色的"单页上下 2"文字

---

## 7. 未来开发计划

### 7.1 短期目标

1. **实现单页左右 1 布局**

   - 定义左右分栏结构
   - 实现字段分配逻辑
   - 添加间距和对齐控制

2. **实现单页左右 2 布局**

   - 定义不同的分栏策略
   - 实现字段分配逻辑
   - 支持自定义配置

3. **实现单页上下 1 布局**

   - 定义上下分栏结构
   - 实现字段分配逻辑
   - 添加间距和对齐控制

4. **实现单页上下 2 布局**
   - 定义不同的分栏策略
   - 实现字段分配逻辑
   - 支持自定义配置

### 7.2 中期目标

1. **布局配置系统**

   - 为每种布局添加独立的配置选项
   - 支持分栏比例调整
   - 支持字段显示/隐藏控制

2. **布局预览优化**
   - 添加布局示意图
   - 提供布局说明文字
   - 实时预览配置效果

### 7.3 长期目标

1. **自定义布局**

   - 允许用户自定义布局模板
   - 支持拖拽式布局编辑
   - 保存和共享布局模板

2. **布局库**
   - 建立常用布局库
   - 支持导入/导出布局
   - 社区分享功能

---

## 8. 技术细节

### 8.1 样式系统

每个布局函数都可以使用以下资源：

- `dynamicStyles`: 动态样式对象
- `fontFamily`: 主字体
- `secondaryFontFamily`: 次字体
- `fontSize`: 字体大小
- `spacing`: 间距设置
- `lineHeight`: 行高
- `textAlign`: 对齐方式

### 8.2 数据访问

每个布局函数都可以访问：

- `processedFields`: 处理后的六字段数据
- `labelData`: 完整的标签数据对象
- `margins`: 页面边距信息
- `currentWidth`: 当前页面宽度

### 8.3 渲染组件

可用的 React PDF 组件：

- `<View>`: 容器组件
- `<Text>`: 文本组件
- `<SmartMixedFontText>`: 智能混合字体文本组件

---

## 9. 注意事项

### 9.1 兼容性

- 保持`renderSixFields()`函数名不变，确保现有代码正常工作
- 所有 PDF 生成和导出功能都会自动使用新的布局系统

### 9.2 性能

- 每次切换布局时会重新渲染 PDF
- 建议在实现复杂布局时优化渲染性能
- 考虑使用 React.memo 优化不必要的重渲染

### 9.3 调试

- 每个布局函数都是独立的，便于单独调试
- 可以在控制台查看`labelCategory`的值
- 建议为每个布局添加详细的注释

---

## 10. 相关文档

- **PDF 功能实现总结.md** - 完整的 PDF 功能技术文档
- **批量导出 PDF 功能实现总结.md** - 批量处理功能文档
- **智能混合字体功能总结.md** - 混合字体处理文档

---

## 11. 总结

本次修改成功实现了多布局系统的基础架构：

✅ **已完成**：

1. 创建了 5 个独立的布局渲染函数
2. 实现了基于标签分类的路由系统
3. 保持了代码的兼容性和可扩展性
4. 为阶梯标布局保留了完整的功能实现

🚧 **待实现**：

1. 单页左右 1/2 的完整布局逻辑
2. 单页上下 1/2 的完整布局逻辑
3. 每种布局的独立配置选项
4. 布局预览和说明功能

通过这次重构，PDF 预览系统获得了更好的可扩展性和可维护性，为未来添加更多布局类型打下了坚实的基础。
