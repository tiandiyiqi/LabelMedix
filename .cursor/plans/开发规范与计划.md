# 开发规范与计划

**负责人**: Alex  
**协作者**: Bob, Emma  
**创建时间**: 2025-01-13  
**状态**: 进行中

## 1. 开发阶段规划

### 1.1 总体开发计划

基于药品标签开发计划，项目分为 8 个主要阶段，总计 16 周开发周期。

### 1.2 阶段划分

#### 阶段 1: 基础功能开发 ✅ 已完成 (第 1-2 周)

- ✅ 搭建 Next.js + Express.js 项目框架
- ✅ 实现标签编辑器界面
- ✅ 开发基础组件库
- ✅ 建立项目结构和配置

#### 阶段 2: 核心功能实现 ✅ 已完成 (第 3-4 周)

- ✅ 实现多语言选择功能
- ✅ 开发智能字体映射系统
- ✅ 实现实时预览功能
- ✅ 开发动态页面尺寸计算

#### 阶段 3: PDF 功能开发 🔄 进行中 (第 5-6 周)

- ✅ 集成 PDF 处理库
- 🔄 完善 PDF 生成功能
- 🔄 实现复杂页面尺寸规则
- ⏳ 开发 PDF 导出功能

#### 阶段 4: 数据库集成与数据持久化 ⏳ 待开始 (第 7-8 周)

- ⏳ MySQL 数据库连接配置
- ⏳ Sequelize 数据模型实现
- ⏳ 项目数据持久化存储
- ⏳ 数据查询和操作接口

#### 阶段 5: 批量处理与性能优化 ⏳ 待开始 (第 9-10 周)

- ⏳ 批量项目创建功能
- ⏳ 批量 PDF 导出功能
- ⏳ 系统性能优化
- ⏳ 代码分割和懒加载

#### 阶段 6: 测试与质量保障 ⏳ 待开始 (第 11-12 周)

- ⏳ 单元测试框架搭建
- ⏳ 集成测试实现
- ⏳ 端到端测试
- ⏳ 自动化测试流程

#### 阶段 7: 部署与运维 ⏳ 待开始 (第 13-14 周)

- ⏳ 生产环境部署配置
- ⏳ CI/CD 流水线搭建
- ⏳ 监控和日志系统
- ⏳ 备份和恢复策略

#### 阶段 8: 用户认证系统 ⏳ 最后执行 (第 15-16 周)

- ⏳ JWT 认证系统实现
- ⏳ 用户注册和登录功能
- ⏳ 权限管理系统
- ⏳ API 安全加固

## 2. 任务分配

### 2.1 团队成员职责

#### Mike - 团队领航者

- 整体项目规划和协调
- 关键决策制定
- 进度监控和风险管理
- 团队沟通协调

#### Emma - 产品创意官

- 产品设计和用户体验
- 需求分析和用户测试
- 界面设计和交互流程
- 用户反馈收集和分析

#### Bob - 架构大师

- 系统架构设计和技术选型
- 数据库设计和 API 设计
- 技术难题解决
- 代码评审和技术指导

#### Alex - 代码魔法师

- 前端功能开发和实现
- 后端 API 开发和实现
- 代码编写和优化
- 技术文档编写

#### David - 数据洞察者

- 数据模型设计和实现
- 数据分析和处理
- 性能监控和优化
- 数据质量保障

#### Lily - 质量守护者

- 测试计划制定和执行
- 质量控制和检查
- 问题跟踪和修复
- 验收测试和发布

### 2.2 当前阶段任务分配 (第 5-6 周)

#### Alex 负责

- PDF 生成功能完善
- 复杂页面尺寸规则实现
- PDF 导出功能开发

#### Bob 协助

- 技术架构优化
- 性能问题解决
- 代码评审

#### Emma 协助

- 用户体验优化
- 界面交互改进
- 用户测试

#### Lily 负责

- 功能测试
- 质量检查
- 问题跟踪

## 3. 时间节点

### 3.1 详细时间规划

#### 第 5 周 (2025-01-13 至 2025-01-19)

- **周一-周二**: PDF 生成功能完善
- **周三-周四**: 复杂页面尺寸规则实现
- **周五**: 功能测试和问题修复

#### 第 6 周 (2025-01-20 至 2025-01-26)

- **周一-周二**: PDF 导出功能开发
- **周三-周四**: 功能集成和测试
- **周五**: 阶段验收和总结

#### 第 7-8 周 (2025-01-27 至 2025-02-09)

- **数据库集成**: MySQL 连接和配置
- **数据模型**: Sequelize 模型实现
- **API 开发**: 数据操作接口
- **测试**: 数据持久化测试

#### 第 9-10 周 (2025-02-10 至 2025-02-23)

- **批量处理**: 多文件处理功能
- **性能优化**: 代码分割和懒加载
- **缓存机制**: Redis 缓存实现
- **监控**: 性能监控系统

#### 第 11-12 周 (2025-02-24 至 2025-03-09)

- **测试框架**: Jest 和 Cypress 配置
- **单元测试**: 组件和函数测试
- **集成测试**: API 和数据库测试
- **端到端测试**: 完整流程测试

#### 第 13-14 周 (2025-03-10 至 2025-03-23)

- **部署配置**: Docker 和 Nginx 配置
- **CI/CD**: 自动化部署流水线
- **监控系统**: 日志和性能监控
- **备份策略**: 数据备份和恢复

#### 第 15-16 周 (2025-03-24 至 2025-04-06)

- **认证系统**: JWT 和权限管理
- **安全加固**: API 安全和数据保护
- **最终测试**: 全面系统测试
- **项目交付**: 文档整理和交付

### 3.2 里程碑节点

#### 里程碑 1: 核心功能完成 (第 4 周结束)

- ✅ 多语言编辑器完成
- ✅ 实时预览功能完成
- ✅ 智能字体映射完成

#### 里程碑 2: PDF 功能完成 (第 6 周结束)

- 🔄 PDF 生成功能完成
- 🔄 导出功能完成
- 🔄 页面尺寸规则完成

#### 里程碑 3: 数据持久化完成 (第 8 周结束)

- ⏳ 数据库集成完成
- ⏳ API 接口完成
- ⏳ 数据操作完成

#### 里程碑 4: 系统优化完成 (第 10 周结束)

- ⏳ 性能优化完成
- ⏳ 批量处理完成
- ⏳ 缓存机制完成

#### 里程碑 5: 测试完成 (第 12 周结束)

- ⏳ 测试框架完成
- ⏳ 自动化测试完成
- ⏳ 质量保障完成

#### 里程碑 6: 部署完成 (第 14 周结束)

- ⏳ 生产环境部署完成
- ⏳ 监控系统完成
- ⏳ 运维体系完成

#### 里程碑 7: 项目交付 (第 16 周结束)

- ⏳ 认证系统完成
- ⏳ 安全加固完成
- ⏳ 项目交付完成

## 4. 编码规范

### 4.1 TypeScript 规范

#### 4.1.1 基本规范

```typescript
// 使用 interface 定义类型
interface LabelData {
  selectedLanguage: string;
  selectedNumber: string;
  drugInfo: string;
  fontSize: number;
  labelWidth: number;
  labelHeight: number;
  fontFamily: string;
  spacing: number;
  lineHeight: number;
  currentWidth: number;
}

// 使用 type 定义联合类型
type LanguageCode =
  | "AE"
  | "BG"
  | "CN"
  | "CZ"
  | "DE"
  | "DK"
  | "GB"
  | "GR"
  | "ID"
  | "IL"
  | "IN"
  | "IT"
  | "JP"
  | "KR"
  | "MY"
  | "NL"
  | "NO"
  | "PL"
  | "PT"
  | "RO"
  | "RS"
  | "RU"
  | "SE"
  | "TH"
  | "TR"
  | "VN";

// 使用 enum 定义常量
enum FontFamily {
  STHeiti = "STHeiti",
  Arial = "Arial",
  ArialUnicode = "Arial Unicode",
}
```

#### 4.1.2 函数规范

```typescript
// 函数参数和返回值类型
function calculatePageWidth(initialWidth: number, pageNumber: number): number {
  // 函数实现
  return initialWidth + widthAdjustment;
}

// 异步函数
async function generatePDF(labelData: LabelData): Promise<Blob> {
  // 异步操作
  return await pdf(document).toBlob();
}

// 箭头函数
const handleLanguageChange = (
  e: React.ChangeEvent<HTMLSelectElement>
): void => {
  const newLanguage = e.target.value;
  updateLabelData({ selectedLanguage: newLanguage });
};
```

#### 4.1.3 组件规范

```typescript
// React 组件类型定义
interface LabelEditorProps {
  labelData: LabelData;
  updateLabelData: (data: Partial<LabelData>) => void;
}

// 函数组件
export default function LabelEditor({
  labelData,
  updateLabelData,
}: LabelEditorProps): JSX.Element {
  // 组件实现
  return <div className="label-editor">{/* 组件内容 */}</div>;
}

// 使用 React.FC (不推荐)
const LabelEditor: React.FC<LabelEditorProps> = ({
  labelData,
  updateLabelData,
}) => {
  // 组件实现
};
```

### 4.2 React 规范

#### 4.2.1 组件结构

```typescript
// 组件文件结构
import React, { useState, useEffect, useContext } from "react";
import { SomeComponent } from "./SomeComponent";
import { useLabelContext } from "../../lib/context/LabelContext";

// 类型定义
interface ComponentProps {
  // props 类型
}

// 组件实现
export default function Component({}: ComponentProps): JSX.Element {
  // Hooks
  const [state, setState] = useState<StateType>(initialState);
  const { labelData, updateLabelData } = useLabelContext();

  // 事件处理函数
  const handleEvent = (): void => {
    // 处理逻辑
  };

  // 副作用
  useEffect(() => {
    // 副作用逻辑
  }, [dependencies]);

  // 渲染
  return <div className="component">{/* JSX 内容 */}</div>;
}
```

#### 4.2.2 Hooks 使用规范

```typescript
// useState 使用
const [count, setCount] = useState<number>(0);
const [user, setUser] = useState<User | null>(null);

// useEffect 使用
useEffect(() => {
  // 组件挂载时执行
}, []);

useEffect(() => {
  // 依赖变化时执行
}, [dependency]);

useEffect(() => {
  // 清理函数
  return () => {
    // 清理逻辑
  };
}, []);

// useContext 使用
const context = useContext(ContextType);
if (!context) {
  throw new Error("Context must be used within Provider");
}
```

#### 4.2.3 事件处理规范

```typescript
// 事件处理函数命名
const handleClick = (): void => { };
const handleChange = (e: React.ChangeEvent<HTMLInputElement>): void => { };
const handleSubmit = (e: React.FormEvent<HTMLFormElement>): void => { };

// 内联事件处理
<button onClick={() => handleClick()}>Click</button>
<input onChange={handleChange} />
<form onSubmit={handleSubmit} />
```

### 4.3 CSS 规范

#### 4.3.1 Tailwind CSS 使用

```typescript
// 类名组合
const buttonClasses = `
  px-4 py-2 rounded-lg
  bg-blue-500 text-white
  hover:bg-blue-600
  focus:outline-none focus:ring-2 focus:ring-blue-500
  transition-colors duration-200
`;

// 条件类名
const className = `
  base-classes
  ${isActive ? "active-classes" : "inactive-classes"}
  ${variant === "primary" ? "primary-classes" : "secondary-classes"}
`;
```

#### 4.3.2 样式组织

```typescript
// 样式对象
const styles = {
  container: "flex flex-col h-full",
  header: "flex items-center justify-between p-4",
  content: "flex-1 overflow-auto",
  footer: "flex items-center justify-end p-4",
};

// 内联样式
const inlineStyles = {
  backgroundColor: theme.primary,
  color: theme.text,
  fontSize: "16px",
};
```

### 4.4 文件组织规范

#### 4.4.1 目录结构

```
FrontEnd/
├── app/
│   ├── components/          # 页面组件
│   │   ├── LabelEditor.tsx
│   │   ├── PDFPreview.tsx
│   │   └── ProjectList.tsx
│   ├── lib/                # 工具库
│   │   ├── context/        # React Context
│   │   ├── utils/          # 工具函数
│   │   └── types/          # 类型定义
│   └── styles/             # 样式文件
├── components/             # 通用组件
│   ├── ui/                # UI 组件
│   └── layout/            # 布局组件
└── public/                # 静态资源
```

#### 4.4.2 文件命名规范

```typescript
// 组件文件：PascalCase
LabelEditor.tsx;
PDFPreview.tsx;
ProjectList.tsx;

// 工具文件：camelCase
calculatePageWidth.ts;
formatDate.ts;
validateInput.ts;

// 类型文件：camelCase
labelTypes.ts;
apiTypes.ts;
userTypes.ts;

// 常量文件：camelCase
constants.ts;
config.ts;
```

## 5. 命名约定

### 5.1 变量命名

```typescript
// 使用 camelCase
const userName = "john";
const isLoggedIn = true;
const userList = [];

// 常量使用 UPPER_SNAKE_CASE
const MAX_FILE_SIZE = 10 * 1024 * 1024;
const DEFAULT_LANGUAGE = "CN";
const API_BASE_URL = "https://api.example.com";
```

### 5.2 函数命名

```typescript
// 使用 camelCase，动词开头
function getUserById(id: number): User {}
function validateEmail(email: string): boolean {}
function handleSubmit(): void {}

// 事件处理函数以 handle 开头
const handleClick = (): void => {};
const handleChange = (): void => {};
const handleSubmit = (): void => {};
```

### 5.3 组件命名

```typescript
// 组件使用 PascalCase
function LabelEditor(): JSX.Element {}
function PDFPreview(): JSX.Element {}
function ProjectList(): JSX.Element {}

// 组件文件与组件名一致
// LabelEditor.tsx -> LabelEditor
// PDFPreview.tsx -> PDFPreview
```

### 5.4 类型命名

```typescript
// Interface 使用 PascalCase，以 I 开头（可选）
interface LabelData {}
interface UserInfo {}
interface ApiResponse {}

// Type 使用 PascalCase
type LanguageCode = string;
type FontFamily = "STHeiti" | "Arial" | "Arial Unicode";

// Enum 使用 PascalCase
enum UserRole {
  Admin = "admin",
  User = "user",
}
```

## 6. 组件使用说明

### 6.1 核心组件

#### 6.1.1 LabelEditor 组件

```typescript
// 使用方式
import LabelEditor from "@/app/components/LabelEditor";

function App() {
  return (
    <div className="app">
      <LabelEditor />
    </div>
  );
}

// Props 接口
interface LabelEditorProps {
  // 当前无外部 props，使用 Context
}

// 功能说明
// - 多语言选择
// - 页面序号选择
// - 文本编辑
// - 字体参数调整
```

#### 6.1.2 PDFPreview 组件

```typescript
// 使用方式
import PDFPreview from "@/app/components/PDFPreview";

function App() {
  return (
    <div className="app">
      <PDFPreview />
    </div>
  );
}

// 功能说明
// - 实时 PDF 预览
// - 页面尺寸显示
// - 边距设置
// - PDF 导出功能
```

#### 6.1.3 ProjectList 组件

```typescript
// 使用方式
import ProjectList from "@/app/components/ProjectList";

function App() {
  return (
    <div className="app">
      <ProjectList />
    </div>
  );
}

// 功能说明
// - 项目列表显示
// - 项目搜索
// - 项目编辑和删除
// - 新建项目
```

### 6.2 工具函数

#### 6.2.1 calculatePageWidth 函数

```typescript
// 使用方式
import { calculatePageWidth } from "@/app/utils/calculatePageWidth";

const currentWidth = calculatePageWidth(initialWidth, pageNumber);

// 参数说明
// initialWidth: number - 初始页面宽度
// pageNumber: number - 页面序号
// 返回值: number - 计算后的页面宽度
```

#### 6.2.2 calculatePageMargins 函数

```typescript
// 使用方式
import { calculatePageMargins } from "@/app/utils/calculatePageWidth";

const margins = calculatePageMargins(pageNumber);

// 参数说明
// pageNumber: number - 页面序号
// 返回值: { top: number, bottom: number, left: number, right: number }
```

### 6.3 Context 使用

#### 6.3.1 LabelContext

```typescript
// 使用方式
import { useLabelContext } from "@/lib/context/LabelContext";

function Component() {
  const { labelData, updateLabelData } = useLabelContext();

  // 读取数据
  const { selectedLanguage, fontSize } = labelData;

  // 更新数据
  updateLabelData({ fontSize: 12 });
}
```

## 7. 开发工具配置

### 7.1 ESLint 配置

```json
{
  "extends": ["next/core-web-vitals", "@typescript-eslint/recommended"],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "prefer-const": "error",
    "no-var": "error"
  }
}
```

### 7.2 Prettier 配置

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

### 7.3 TypeScript 配置

```json
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

## 8. 代码审查规范

### 8.1 审查流程

1. **提交前自检**: 开发者自行检查代码
2. **自动化检查**: ESLint 和 Prettier 自动检查
3. **同行评审**: 团队成员代码评审
4. **合并前检查**: 最终质量检查

### 8.2 审查要点

- **代码质量**: 逻辑正确性、性能优化
- **代码规范**: 命名规范、格式规范
- **安全性**: 输入验证、错误处理
- **可维护性**: 代码结构、注释文档

### 8.3 审查工具

- **ESLint**: 代码质量检查
- **Prettier**: 代码格式检查
- **TypeScript**: 类型检查
- **Husky**: Git 钩子检查

## 9. 技术难题思维链分析

### 9.1 PDF 生成性能优化

**问题**: PDF 生成速度慢，影响用户体验
**分析过程**:

1. 识别性能瓶颈：字体加载、文本渲染、页面计算
2. 优化策略：字体预加载、文本缓存、异步处理
3. 实现方案：Web Workers、缓存机制、增量更新
   **解决方案**: 使用 Web Workers 进行 PDF 生成，实现字体预加载和文本缓存

### 9.2 多语言字体渲染

**问题**: 不同语言字体渲染不一致
**分析过程**:

1. 字体映射规则：中文 →STHeiti，泰文/阿拉伯文 →Arial Unicode
2. 字体加载策略：按需加载、预加载、回退机制
3. 渲染优化：字体子集、压缩、缓存
   **解决方案**: 建立智能字体映射系统，实现按需加载和回退机制

### 9.3 实时预览性能

**问题**: 实时预览响应慢，影响编辑体验
**分析过程**:

1. 更新频率：每次输入都触发预览更新
2. 优化策略：防抖、节流、增量更新
3. 性能监控：响应时间、内存使用、CPU 占用
   **解决方案**: 使用防抖机制，实现增量更新和性能监控

---

**文档版本**: v1.0  
**最后更新**: 2025-01-13  
**下次评审**: 2025-01-20
