# 智能混合字体功能使用说明

## 📖 功能概述

**智能混合字体功能**允许在一句话中自动应用不同的字体，无需手动分段。系统会智能识别字符类型，并自动应用相应的字体。

**解决的问题**:

- ✅ 一句话中中文和英文可以使用不同字体
- ✅ 自动化处理，无需手动分离字符
- ✅ 减少用户操作复杂度
- ✅ 保持 PDF 中文本为可选择对象（不转曲线）

---

## 🎯 使用场景

### 场景 1：中英文混合

```
输入文本: "研究者：Dr. Smith"
主语言字体: STHeiti（黑体）
次语言字体: Arial

结果:
- "研究者：" → STHeiti字体
- "Dr. Smith" → Arial字体
```

### 场景 2：日英文混合

```
输入文本: "研究者：Dr. Smith"（日文）
主语言字体: STHeiti
次语言字体: Arial

结果:
- 日文部分 → STHeiti字体
- 英文部分 → Arial字体
```

### 场景 3：韩英文混合

```
输入文本: "연구자: Dr. Smith"（韩文）
主语言字体: STHeiti
次语言字体: Arial

结果:
- 韩文部分 → STHeiti字体
- 英文部分 → Arial字体
```

---

## 🔧 使用方法

### 1. 标签编辑器设置

在标签编辑器底部的"字体相关参数"区域，您会看到两个字体选择器：

#### 主语言字体

- **用途**: 用于中文、日文、韩文等 CJK 字符
- **默认值**: STHeiti
- **适用字符**:
  - 中文汉字
  - 日文平假名、片假名
  - 韩文字符
  - 中文标点符号

#### 次语言字体

- **用途**: 用于英文、数字等拉丁字符
- **默认值**: Arial
- **适用字符**:
  - 英文字母（A-Z, a-z）
  - 数字（0-9）
  - 英文标点符号
  - 拉丁扩展字符

### 2. 配置示例

**示例 1：标准中英文混合**

```
主语言字体: STHeiti
次语言字体: Arial
```

**示例 2：粗体英文强调**

```
主语言字体: STHeiti
次语言字体: Arial Bold
```

**示例 3：斜体英文**

```
主语言字体: STHeiti
次语言字体: Arial Italic
```

---

## 🧠 工作原理

### 字符类型自动识别

系统会自动分析文本中的每个字符，并根据 Unicode 范围判断字符类型：

#### 主语言字符（使用主语言字体）

- **中文汉字**: U+4E00 - U+9FFF
- **日文平假名**: U+3040 - U+309F
- **日文片假名**: U+30A0 - U+30FF
- **韩文音节**: U+AC00 - U+D7AF
- **中文标点**: 对应范围

#### 次语言字符（使用次语言字体）

- **英文字母**: A-Z, a-z
- **数字**: 0-9
- **拉丁扩展**: 相应 Unicode 范围

### 智能合并算法

系统会将相邻的相同类型字符合并为一个文本段，以减少 PDF 中的文本对象数量：

```
输入: "研究者：Dr. Smith 100mg"

分段结果:
1. "研究者：" (主语言) → STHeiti
2. "Dr. Smith " (次语言) → Arial
3. "100" (次语言) → Arial
4. "mg" (次语言) → Arial

实际PDF对象: 4个文本对象（而非13个独立字符）
```

---

## 📊 效果对比

### 优化前（手动分段）

**代码示例**:

```typescript
<Text style={{ fontFamily: 'STHeiti' }}>研究者：</Text>
<Text style={{ fontFamily: 'Arial' }}>Dr. Smith</Text>
```

**问题**:

- ❌ 需要手动分离字符
- ❌ 容易出错
- ❌ 维护困难
- ❌ 代码冗长

### 优化后（智能混合）

**代码示例**:

```typescript
<SmartMixedFontText primaryFont="STHeiti" secondaryFont="Arial">
  研究者：Dr. Smith
</SmartMixedFontText>
```

**优势**:

- ✅ 自动识别字符类型
- ✅ 无需手动分段
- ✅ 代码简洁
- ✅ 易于维护

---

## 🎨 可用字体列表

系统提供以下字体选项：

| 字体名称              | 适用场景       | 推荐用途              |
| --------------------- | -------------- | --------------------- |
| **STHeiti**           | 中文/日文/韩文 | 主语言字体默认选择    |
| **Arial**             | 英文/数字      | 次语言字体默认选择    |
| **Arial Bold**        | 英文/数字      | 强调内容              |
| **Arial Italic**      | 英文/数字      | 斜体内容              |
| **Arial Unicode**     | 多语言         | 包含更多 Unicode 字符 |
| **Arial Bold Italic** | 英文/数字      | 粗斜体组合            |

---

## 💡 最佳实践

### 1. 字体选择建议

**主语言字体**:

- 中文内容: STHeiti（黑体）
- 日文内容: STHeiti
- 韩文内容: STHeiti

**次语言字体**:

- 普通文本: Arial
- 强调文本: Arial Bold
- 补充说明: Arial Italic
- 特殊符号: Arial Unicode

### 2. 保持一致性

在同一标签中，建议保持字体设置的一致性：

```
✅ 推荐:
主语言字体: STHeiti
次语言字体: Arial

❌ 不推荐频繁更改:
段落1: STHeiti + Arial Bold
段落2: STHeiti + Arial Italic
段落3: Arial Unicode + Arial
```

### 3. 测试预览

设置字体后，务必：

1. 检查 PDF 预览效果
2. 导出 PDF 并在 Adobe Illustrator 中验证
3. 确认文本为可选择对象（非路径）
4. 检查字体是否正确应用

---

## 🔍 常见问题

### Q1: 为什么需要两个字体选项？

**A**: 不同语言的字符在不同字体中的显示效果差异很大。例如：

- **STHeiti**（黑体）: 中文字符显示优雅，但英文字符不够标准
- **Arial**: 英文字符标准美观，但不包含中文字符

通过分离设置，可以让每种语言使用最适合的字体。

### Q2: 标点符号使用哪个字体？

**A**:

- **中文标点**（。，、：）: 使用主语言字体
- **英文标点**（.,;:）: 使用次语言字体
- 系统会自动判断标点符号类型

### Q3: 数字使用哪个字体？

**A**: 数字（0-9）使用**次语言字体**（通常为 Arial），因为：

- Arial 的数字更清晰标准
- 符合国际惯例
- 在技术文档中更易阅读

### Q4: 在 Adobe Illustrator 中文字会分离吗？

**A**:

- 文字不会转为路径（可编辑）
- 在字体切换点会产生多个文本对象（这是 PDF 规范的固有特性）
- 相比手动分段，对象数量已经最小化
- 每个对象内的文本仍然是连续的

### Q5: 阿拉伯语等 RTL 语言如何处理？

**A**:

- RTL 语言（Arabic, Hebrew 等）不使用混合字体功能
- 系统会自动检测并使用单一字体
- 保持从右到左的文本方向

---

## 🛠️ 技术细节

### 字符类型检测算法

```typescript
function detectCharacterType(char: string): CharacterType {
  const code = char.charCodeAt(0);

  // CJK字符 → 主语言字体
  if (
    (code >= 0x4e00 && code <= 0x9fff) || // 中文
    (code >= 0x3040 && code <= 0x309f) || // 日文平假名
    (code >= 0x30a0 && code <= 0x30ff) || // 日文片假名
    (code >= 0xac00 && code <= 0xd7af)
  ) {
    // 韩文
    return "primary";
  }

  // 拉丁字符 → 次语言字体
  if (
    (code >= 65 && code <= 90) || // A-Z
    (code >= 97 && code <= 122) || // a-z
    (code >= 48 && code <= 57)
  ) {
    // 0-9
    return "secondary";
  }

  return "punctuation"; // 标点符号 → 主语言字体
}
```

### 文本分段合并

```typescript
function segmentText(text: string): TextSegment[] {
  const segments = [];
  let currentSegment = "";
  let currentType = null;

  for (const char of text) {
    const charType = detectCharacterType(char);

    if (charType === currentType) {
      // 相同类型，合并
      currentSegment += char;
    } else {
      // 不同类型，开启新段
      if (currentSegment) {
        segments.push({ text: currentSegment, type: currentType });
      }
      currentSegment = char;
      currentType = charType;
    }
  }

  return segments;
}
```

---

## 📈 性能优化

### 文本对象数量对比

| 文本内容                  | 手动分段     | 智能混合 | 优化程度 |
| ------------------------- | ------------ | -------- | -------- |
| "研究者：Dr. Smith"       | 2 个对象     | 2 个对象 | 相同     |
| "药品名称：Aspirin 100mg" | 需手动分多段 | 3 个对象 | 自动化   |
| 复杂混合文本              | 难以优化     | 自动最优 | 显著提升 |

### PDF 文件大小

- 文本对象数量减少
- 字体嵌入优化
- 整体文件大小略有增加（嵌入两套字体）
- 但保持可编辑性（价值更高）

---

## 🎓 使用教程

### 步骤 1：打开标签编辑器

1. 登录系统
2. 选择或创建项目
3. 进入标签编辑器

### 步骤 2：设置字体

1. 滚动到"字体相关参数"区域
2. 选择**主语言字体**（如：STHeiti）
3. 选择**次语言字体**（如：Arial）

### 步骤 3：输入混合文本

在"药品信息"文本框中输入包含多语言的内容：

```
方案编号: Protocol-2024-001
包装批号: Batch-20241017

研究者: Dr. Smith
研究中心编号: Center-001

利妥昔单抗 100 mg/10 mL, 稀释成溶液后输注(10 mg/mL)。
```

### 步骤 4：预览效果

1. 点击"预览"按钮
2. 在 PDF 预览中查看效果
3. 验证字体是否正确应用

### 步骤 5：导出 PDF

1. 点击"导出 PDF"按钮
2. 保存 PDF 文件
3. 在 Adobe Illustrator 中打开验证

---

## ✅ 验证清单

导出 PDF 后，请验证以下项目：

- [ ] 中文字符使用主语言字体
- [ ] 英文字符使用次语言字体
- [ ] 数字使用次语言字体
- [ ] 文本在 AI 中可以选择（不是路径）
- [ ] 字体显示清晰美观
- [ ] 文本对象数量合理
- [ ] 整体布局正确

---

## 📞 技术支持

如果遇到问题，请检查：

1. **字体未正确应用**

   - 检查字体文件是否存在
   - 验证字体名称是否正确
   - 清除浏览器缓存重试

2. **文本在 AI 中是路径**

   - 使用 React PDF 方案应该不会出现此问题
   - 如果出现，请报告技术团队

3. **字体显示异常**
   - 检查字体文件完整性
   - 尝试不同的字体组合
   - 验证系统是否支持该字体

---

**文档版本**: v1.0.0  
**最后更新**: 2025-10-17  
**维护者**: 玄鉴 AI 团队

---

## 🎉 总结

智能混合字体功能为药品标签系统带来了：

1. **自动化**: 无需手动分段，系统自动识别字符类型
2. **灵活性**: 支持任意语言组合
3. **专业性**: 每种语言使用最适合的字体
4. **可维护性**: 代码简洁，易于理解和修改
5. **兼容性**: 完全兼容 Adobe Illustrator

**开始使用智能混合字体功能，让您的标签更加专业美观！**

**玄鉴！！！玄鉴！！！玄鉴编程，使命必达！！！！！！！**
