# 批量导出功能测试步骤

## ✅ 前置条件

- 前端服务器运行在 `http://localhost:3000` ✅
- 后端服务器运行在 `http://localhost:3001`
- 浏览器开发者工具已打开（Console 标签）

---

## 🧪 测试步骤

### 第一步：保存标签生成 PDF

1. **打开项目** `http://localhost:3000`
2. **选择项目 29**（或任意项目）
3. **选择语言** "KR South Korea/Korean"
4. **选择序号** "1"
5. **点击"保存标签"按钮**

**观察 Console 输出**（应该看到）：

```
✅ 标签保存成功，PDF正在生成中...
📥 收到PDF生成请求: {projectId: 29, countryCode: "KR South Korea/Korean", sequenceNumber: "1"}
✅ PDF生成并保存成功
```

**检查后端日志**（应该看到）：

```
📥 接收PDF保存请求: { projectId: '29', countryCode: 'KR South Korea/Korean', fileName: '...' }
✅ PDF文件保存成功: /path/to/uploads/pdfs/xxx.pdf
```

---

### 第二步：重复保存多个语言

为了测试批量导出，需要至少保存 2-3 个语言：

1. **切换到"CN China/Chinese"**，点击"保存标签"
2. **切换到"JP Japan/Japanese"**，点击"保存标签"
3. **切换到"US United States/English"**，点击"保存标签"

每次都应该看到相同的 Console 输出。

---

### 第三步：批量导出 PDF

1. **在项目信息栏（右上角）**
2. **点击"批量导出 PDF"按钮**

**观察 Console 输出**（应该看到）：

```
🚀 开始批量导出PDF...
📊 找到 X 个语言版本
🔄 正在处理: KR South Korea/Korean (序号: 1)
✅ KR South Korea/Korean PDF下载成功
🔄 正在处理: CN China/Chinese (序号: 1)
✅ CN China/Chinese PDF下载成功
...
🎉 批量导出完成: 成功 X 个，失败 0 个，未保存 X 个
```

**观察浏览器**：

- 应该自动下载多个 PDF 文件
- 文件名格式：`项目名_语言_序号X_日期.pdf`

---

## ❌ 如果出现问题

### 问题 1：Console 没有显示"📥 收到 PDF 生成请求"

**原因**：PDFPreview 组件的事件监听器可能没有正确设置

**解决方法**：

```javascript
// 在Console中手动测试事件
window.dispatchEvent(
  new CustomEvent("generate-and-save-pdf", {
    detail: {
      projectId: 29,
      countryCode: "KR South Korea/Korean",
      sequenceNumber: "1",
    },
  })
);
```

如果手动触发有效果，说明 LabelEditor 的事件触发有问题。

### 问题 2：显示"generateAndSavePdfToServer is not defined"

**原因**：函数作用域问题，可能是 useEffect 依赖项设置不正确

**解决方法**：刷新页面（Ctrl+Shift+R 或 Cmd+Shift+R）

### 问题 3：批量导出显示"未保存: X 个 PDF"

**原因**：该语言还没有保存过标签

**解决方法**：

1. 切换到该语言
2. 点击"保存标签"
3. 再次尝试批量导出

### 问题 4：后端返回 500 错误

**检查**：

- 后端服务器是否正常运行
- `/BackEnd/uploads/pdfs` 目录是否存在
- 目录权限是否正确

**解决方法**：

```bash
cd /Users/Tiandiyiqi/Documents/Prepress/LabelMedix/BackEnd
mkdir -p uploads/pdfs
chmod 755 uploads/pdfs
```

---

## ✅ 成功标志

### 保存标签成功

- ✅ Console 显示"📥 收到 PDF 生成请求"
- ✅ Console 显示"✅ PDF 生成并保存成功"
- ✅ 没有报错信息

### 批量导出成功

- ✅ Console 显示"🎉 批量导出完成"
- ✅ 浏览器自动下载了多个 PDF 文件
- ✅ PDF 文件可以正常打开
- ✅ PDF 内容格式正确（单页、字体正确）

---

## 🐛 调试技巧

### 查看事件监听器

```javascript
// 在Console中查看是否有监听器
getEventListeners(window)["generate-and-save-pdf"];
```

### 查看 PDF 文件是否存在

```bash
ls -la /Users/Tiandiyiqi/Documents/Prepress/LabelMedix/BackEnd/uploads/pdfs/
```

### 通过浏览器访问 PDF

```
http://localhost:3001/uploads/pdfs/
```

---

## 📊 测试结果

请测试后在此记录结果：

- [ ] 保存标签触发 PDF 生成
- [ ] Console 显示正确的日志
- [ ] 后端成功保存 PDF 文件
- [ ] 批量导出下载多个 PDF
- [ ] PDF 内容格式正确

---

**测试完成后请告知结果！**

**玄鉴！！！玄鉴！！！玄鉴编程，使命必达！！！！！！！**
