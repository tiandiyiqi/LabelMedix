# 字体参数同步修复说明

## 问题描述

当用户在项目清单中点击项目时，标签编辑区的字体相关参数（字体、字号、行距、间距等）没有跟随变化。

## 修复内容

### 1. 修复 ProjectList.tsx 的 handleProjectClick 函数

**位置**: `FrontEnd/app/components/ProjectList.tsx` 第 80-118 行

**修改内容**:

- 在组件顶部添加 `updateLabelData` 到 useLabelContext hook 的解构中
- 在 `handleProjectClick` 函数中，当获取国别详细信息后，同步更新字体设置到 LabelContext

```typescript
// 组件顶部
const { setSelectedProject, updateLabelData } = useLabelContext();

// handleProjectClick 函数中添加
// 同步字体设置到LabelContext
updateLabelData({
  fontFamily: countryDetail.font_family || "Arial",
  secondaryFontFamily: countryDetail.secondary_font_family || "Arial",
  fontSize: countryDetail.font_size || 10,
  spacing: countryDetail.spacing || 1,
  lineHeight: countryDetail.line_height || 1.2,
});
```

### 2. 现有功能确认

经检查，以下功能已经正确实现了字体参数同步：

#### LabelEditor.tsx 的 handleNumberChange 函数

- 当切换序号时，已正确同步字体设置
- 代码位置：第 1757-1856 行

#### LabelEditor.tsx 的 handleLanguageChange 函数

- 当切换语言/国别时，已正确同步字体设置
- 代码位置：第 1601-1750 行

## 数据流说明

### 字体参数的数据来源

字体参数存储在数据库的 `CountryTranslationGroups` 表中，包括：

- `font_family`: 主字体（如：STHeiti、Arial）
- `secondary_font_family`: 次字体（如：Arial）
- `font_size`: 字号（如：10）
- `spacing`: 间距（如：1）
- `line_height`: 行高（如：1.2）

### 数据同步流程

1. **点击项目时**:

   ```
   ProjectList.handleProjectClick
   → getCountryDetails(projectId, countryCode)
   → updateLabelData({ fontFamily, secondaryFontFamily, fontSize, spacing, lineHeight })
   → LabelContext 更新
   → LabelEditor 和 PDFPreview 自动响应更新
   ```

2. **切换序号时**:

   ```
   LabelEditor.handleNumberChange
   → findCountryBySequence(projectId, newNumber)
   → getCountryDetails(projectId, countryCode)
   → updateLabelData({ fontFamily, secondaryFontFamily, fontSize, spacing, lineHeight, ... })
   ```

3. **切换语言时**:
   ```
   LabelEditor.handleLanguageChange
   → findSequenceByCountry(projectId, newLanguage)
   → getCountryDetails(projectId, newLanguage)
   → updateLabelData({ fontFamily, secondaryFontFamily, fontSize, spacing, lineHeight, ... })
   ```

## 测试建议

1. 点击不同项目，检查字体参数是否正确加载
2. 切换同一项目的不同序号，检查字体参数是否正确切换
3. 切换同一项目的不同国别，检查字体参数是否正确切换
4. 确认 PDF 预览区域的显示效果与字体设置一致

## 相关文件

- `FrontEnd/app/components/ProjectList.tsx` - 项目列表组件（已修复）
- `FrontEnd/app/components/LabelEditor.tsx` - 标签编辑器组件（已确认正常）
- `FrontEnd/lib/context/LabelContext.tsx` - 全局状态管理
- `FrontEnd/lib/projectApi.ts` - API 接口定义
