# 文本对齐功能测试清单

## ✅ 已完成的功能

### 1. UI 界面

- [x] 字体设置区域改为 3 列布局
- [x] 缩小主语言字体和次语言字体选择框宽度
- [x] 添加左对齐按钮（AlignLeft 图标）
- [x] 添加右对齐按钮（AlignRight 图标）
- [x] 只有选中的按钮显示蓝色背景 (#30B8D6)
- [x] 未选中的按钮鼠标悬停显示灰色背景
- [x] 左对齐按钮独立 tooltip 显示"左对齐"
- [x] 右对齐按钮独立 tooltip 显示"右对齐"
- [x] 移除外层"文本对齐"tooltip

### 2. 数据层

- [x] `LabelContext` 添加 `textAlign` 字段（默认值：'left'）
- [x] 数据库迁移：添加 `text_align` 字段到 `CountryTranslationGroups` 表
- [x] 更新 `countryTranslationGroup.js` 模型
- [x] 更新 `projectApi.ts` 接口类型定义
- [x] `updateFormattedSummary` 函数支持 `textAlign` 参数

### 3. PDF 渲染

- [x] `PDFPreview.tsx` 从 `labelData` 解构 `textAlign`
- [x] 应用 `textAlign` 到 `contentStyle`
- [x] 应用 `textAlign` 到 `firstParagraphItem`
- [x] 应用 `textAlign` 到 `secondParagraphItem`
- [x] 应用 `textAlign` 到 `remainingContentItem`
- [x] 右对齐时设置 `direction: 'rtl'`
- [x] 左对齐时设置 `direction: 'ltr'`
- [x] PDF 保存到服务器时应用对齐设置
- [x] PDF 导出下载时应用对齐设置

### 4. 文档

- [x] 创建《文本对齐功能添加说明.md》
- [x] 更新数据库设计说明文档
- [x] 添加字体设置字段说明表格
- [x] 说明文本对齐方式的使用场景

## 🧪 建议的测试步骤

### 测试 1：UI 交互测试

1. 打开标签编辑器页面
2. 找到字体设置区域
3. **验证**：布局为 3 列（主字体 | 次字体 | 对齐方式）
4. 点击左对齐按钮
5. **验证**：左对齐按钮显示蓝色背景，右对齐按钮无背景
6. 鼠标悬停在左对齐按钮上
7. **验证**：显示"左对齐"提示文字
8. 点击右对齐按钮
9. **验证**：右对齐按钮显示蓝色背景，左对齐按钮变为无背景
10. 鼠标悬停在右对齐按钮上
11. **验证**：显示"右对齐"提示文字

### 测试 2：数据持久化测试

1. 选择一个项目
2. 设置文本对齐方式为"右对齐"
3. 点击保存按钮
4. **验证**：控制台无错误信息
5. 刷新页面
6. 重新选择相同项目
7. **验证**：对齐方式仍然为"右对齐"（蓝色按钮）

### 测试 3：PDF 预览测试（左对齐）

1. 导入一些文本内容（如英文或中文）
2. 设置对齐方式为"左对齐"
3. 查看 PDF 预览区域
4. **验证**：所有文本内容左对齐显示
5. **验证**：文本从左到右排列（LTR）

### 测试 4：PDF 预览测试（右对齐）

1. 导入一些文本内容（如阿拉伯语或其他 RTL 语言）
2. 设置对齐方式为"右对齐"
3. 查看 PDF 预览区域
4. **验证**：所有文本内容右对齐显示
5. **验证**：文本从右到左排列（RTL）

### 测试 5：PDF 导出测试

1. 设置文本内容和对齐方式
2. 点击"导出 PDF"按钮
3. 打开下载的 PDF 文件
4. **验证**：PDF 中的文本对齐方式与设置一致
5. **验证**：所有 6 个字段的对齐方式都正确

### 测试 6：跨项目测试

1. 创建或选择项目 A
2. 设置对齐方式为"左对齐"并保存
3. 创建或选择项目 B
4. 设置对齐方式为"右对齐"并保存
5. 切换回项目 A
6. **验证**：对齐方式恢复为"左对齐"
7. 切换到项目 B
8. **验证**：对齐方式为"右对齐"

### 测试 7：跨语言测试

1. 选择一个项目
2. 选择语言为"中文"，设置对齐方式为"左对齐"并保存
3. 切换语言为"阿拉伯语"，设置对齐方式为"右对齐"并保存
4. 切换回"中文"
5. **验证**：对齐方式恢复为"左对齐"
6. 切换到"阿拉伯语"
7. **验证**：对齐方式为"右对齐"

### 测试 8：默认值测试

1. 创建一个全新的项目
2. 添加国别和翻译
3. **验证**：对齐方式默认为"左对齐"（左对齐按钮显示蓝色）
4. 打开 PDF 预览
5. **验证**：文本默认左对齐显示

## 🐛 可能的问题和解决方案

### 问题 1：点击按钮没有响应

- **检查**：浏览器控制台是否有错误
- **检查**：`updateLabelData` 函数是否正确调用
- **解决**：确保 `LabelContext` 正确初始化

### 问题 2：对齐设置不保存

- **检查**：`updateFormattedSummary` 是否包含 `textAlign` 参数
- **检查**：数据库迁移是否成功运行
- **解决**：运行 `npm run db:migrate` 确保数据库结构正确

### 问题 3：PDF 中对齐无效

- **检查**：`PDFPreview.tsx` 是否正确从 `labelData` 解构 `textAlign`
- **检查**：PDF 样式对象是否正确应用 `textAlign`
- **解决**：确保所有动态样式都包含 `textAlign` 设置

### 问题 4：tooltip 显示重叠

- **检查**：每个按钮是否包装在独立的 `group` div 中
- **检查**：tooltip 的 `z-index` 是否足够高
- **解决**：确保使用独立的 `group` 和 `group-hover` 类

## 📊 测试结果记录

| 测试项                 | 状态      | 备注 |
| ---------------------- | --------- | ---- |
| UI 交互测试            | ⬜ 待测试 |      |
| 数据持久化测试         | ⬜ 待测试 |      |
| PDF 预览测试（左对齐） | ⬜ 待测试 |      |
| PDF 预览测试（右对齐） | ⬜ 待测试 |      |
| PDF 导出测试           | ⬜ 待测试 |      |
| 跨项目测试             | ⬜ 待测试 |      |
| 跨语言测试             | ⬜ 待测试 |      |
| 默认值测试             | ⬜ 待测试 |      |

## ✨ 功能亮点

1. **直观的 UI 设计**：使用图标按钮代替下拉菜单，操作更直观
2. **独立的 tooltip**：每个按钮都有清晰的提示文字
3. **视觉反馈清晰**：只有选中的按钮显示蓝色，避免混淆
4. **完整的 RTL 支持**：右对齐时自动设置 RTL 方向
5. **数据持久化**：设置保存到数据库，跨会话保持
6. **PDF 完全支持**：预览和导出的 PDF 都正确应用对齐设置
7. **向后兼容**：旧数据自动使用默认的左对齐

## 🔄 后续优化建议

1. **居中对齐**：如需要，可以添加第三个居中对齐按钮
2. **两端对齐**：对于某些语言可能需要两端对齐（justify）
3. **快捷键**：考虑添加快捷键（如 Ctrl+L 左对齐，Ctrl+R 右对齐）
4. **批量操作**：考虑添加批量设置多个国别的对齐方式
5. **智能默认**：根据语言自动推荐对齐方式（如阿拉伯语默认右对齐）
