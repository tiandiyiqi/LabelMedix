# 自动加载项目内容功能说明

## 问题描述

在之前的版本中，当用户从项目列表点击某个项目后，标签编辑器中的 6 个药品信息字段区域（基本信息、编号栏、药品名称、片数内容、药品说明、公司名称）显示为空白，需要用户手动点击"导入"或"重置"按钮才能加载内容。

## 解决方案

### 实现逻辑

在 `LabelEditor.tsx` 中添加了一个新的 `useEffect` Hook，监听 `selectedProject` 和 `selectedLanguage` 的变化，当项目被选中时自动加载内容。

### 核心代码位置

文件：`FrontEnd/app/components/LabelEditor.tsx`  
位置：第 352-430 行

### 加载优先级

1. **优先加载格式化内容**：

   - 首先尝试获取 `formatted_summary` 数据
   - 如果存在格式化数据，则加载 6 个字段的格式化内容
   - 同时恢复格式化状态（formatStates）

2. **备用加载原始内容**：

   - 如果没有格式化数据，则尝试加载 `original_summary` 数据
   - 加载 6 个字段的原始内容
   - 将格式化状态重置为 0（未格式化）

3. **无数据情况**：
   - 如果既没有格式化数据也没有原始数据，在控制台输出警告信息

### 功能特点

1. **自动化体验**：

   - 点击项目后立即显示内容，无需额外操作
   - 减少用户操作步骤，提升用户体验

2. **智能加载**：

   - 优先加载格式化后的内容（用户最后保存的状态）
   - 如果没有格式化内容，则加载原始内容
   - 完整恢复格式化状态标记

3. **与现有功能兼容**：
   - 不影响"导入"按钮的功能
   - 不影响"重置到格式化"功能
   - 不影响"重置到原始"功能
   - 所有现有功能保持正常工作

### 调试信息

系统会在浏览器控制台输出加载状态信息：

- ✅ 已自动加载格式化内容：成功加载格式化数据
- ✅ 已自动加载原始内容（未格式化）：加载原始数据
- ⚠️ 未找到格式化或原始数据：数据库中没有相关数据
- ❌ 自动加载内容失败：加载过程出现错误

## 测试步骤

1. 在项目列表中点击任意项目
2. 观察标签编辑器中的 6 个字段是否自动填充内容
3. 检查内容是否为格式化后的版本（如果存在）
4. 切换不同的国别/序号，观察内容是否正确更新

## 技术细节

### 依赖关系

- 监听：`selectedProject`、`selectedLanguage`
- 调用函数：
  - `getCountryDetails()` - 获取国别详细信息
  - `parseFormattedSummary()` - 解析格式化数据
  - `parseOriginalSummary()` - 解析原始数据
  - `updateLabelData()` - 更新标签数据

### 数据结构

加载的数据包括：

- `basicInfo` - 基本信息
- `numberField` - 编号栏
- `drugName` - 药品名称
- `numberOfSheets` - 片数内容
- `drugDescription` - 药品说明
- `companyName` - 公司名称
- `formatStates` - 各字段的格式化状态（0-未格式化，>0-格式化次数）

## 修改日期

2025 年 10 月 19 日

## 相关功能

- 项目选择功能（ProjectList.tsx）
- 重置到格式化功能（handleResetToFormatted）
- 重置到原始功能（handleResetToOriginal）
- 导入功能（handleImport）
